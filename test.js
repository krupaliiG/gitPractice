const express = require("express");
const fs = require("fs");
const path = require("path");

const app = express();

const generateToPDF = async () => {
  // Assuming you receive the Base64-encoded data in the 'response' variable
  const response =
    "JVBERi0xLjQKJZOMi54gUmVwb3J0TGFiIEdlbmVyYXRlZCBQREYgZG9jdW1lbnQgaHR0cDovL3d3dy5yZXBvcnRsYWIuY29tCjEgMCBvYmoKPDwKL0YxIDIgMCBSIC9GMiAzIDAgUgo+PgplbmRvYmoKMiAwIG9iago8PAovQmFzZUZvbnQgL0hlbHZldGljYSAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyAvTmFtZSAvRjEgL1N1YnR5cGUgL1R5cGUxIC9UeXBlIC9Gb250Cj4+CmVuZG9iagozIDAgb2JqCjw8Ci9CYXNlRm9udCAvSGVsdmV0aWNhLUJvbGQgL0VuY29kaW5nIC9XaW5BbnNpRW5jb2RpbmcgL05hbWUgL0YyIC9TdWJ0eXBlIC9UeXBlMSAvVHlwZSAvRm9udAo+PgplbmRvYmoKNCAwIG9iago8PAovQ29udGVudHMgOCAwIFIgL01lZGlhQm94IFsgMCAwIDIxNiAzMjYgXSAvUGFyZW50IDcgMCBSIC9SZXNvdXJjZXMgPDwKL0ZvbnQgMSAwIFIgL1Byb2NTZXQgWyAvUERGIC9UZXh0IC9JbWFnZUIgL0ltYWdlQyAvSW1hZ2VJIF0KPj4gL1JvdGF0ZSAwIC9UcmFucyA8PAoKPj4gCiAgL1R5cGUgL1BhZ2UKPj4KZW5kb2JqCjUgMCBvYmoKPDwKL1BhZ2VNb2RlIC9Vc2VOb25lIC9QYWdlcyA3IDAgUiAvVHlwZSAvQ2F0YWxvZwo+PgplbmRvYmoKNiAwIG9iago8PAovQXV0aG9yIChhbm9ueW1vdXMpIC9DcmVhdGlvbkRhdGUgKEQ6MjAyMzA1MjkxMzQ1MDArMDAnMDAnKSAvQ3JlYXRvciAoUmVwb3J0TGFiIFBERiBMaWJyYXJ5IC0gd3d3LnJlcG9ydGxhYi5jb20pIC9LZXl3b3JkcyAoKSAvTW9kRGF0ZSAoRDoyMDIzMDUyOTEzNDUwMCswMCcwMCcpIC9Qcm9kdWNlciAoUmVwb3J0TGFiIFBERiBMaWJyYXJ5IC0gd3d3LnJlcG9ydGxhYi5jb20pIAogIC9TdWJqZWN0ICh1bnNwZWNpZmllZCkgL1RpdGxlICh1bnRpdGxlZCkgL1RyYXBwZWQgL0ZhbHNlCj4+CmVuZG9iago3IDAgb2JqCjw8Ci9Db3VudCAxIC9LaWRzIFsgNCAwIFIgXSAvVHlwZSAvUGFnZXMKPj4KZW5kb2JqCjggMCBvYmoKPDwKL0ZpbHRlciBbIC9BU0NJSTg1RGVjb2RlIC9GbGF0ZURlY29kZSBdIC9MZW5ndGggMTM4OQo+PgpzdHJlYW0KR2F0VTNnTVolMCY6TzpTOUhPVVBba1lkWS9zUDdYVWpGUT1YcU0wTlpxW2Y1L0IxX2xNaktUTTJoLDE0XCZiZyNdO1ExbmA5PGAvaUdgQyInPlhIPVdwYUwjRSNISTEzcygoJW4tSHMhKCdIU2NDRzlKaFtQOWpsKXI3aV83YWY4c25walJHNWx0XXUyQUlvIWRqT1ljRi5sIiwoQFlKZktiRS08XW4sKUpLIiVvZDRHRmk6ZzsmTUU5PDhkRU0/YWFdX01xb2duXElQPmhbQTEqMlBcJ2w+QTVZPkBULFwhcGZcIk5pQDdML1oyQVNPbiMsUzZVZiZVYydfLzFzLFE0WmBPZTA+X0deZTo6OihcXlVsZEssXVs6XTVGZWQ3OkY5XkRkPDddbyswSDs7Ry5eQmhRTCk0Q1QmXjNPL2NvI1k4NHJkb29XOiwjTjQraE5wN1VkRCZwSShaJWJaZzJvKUAzNnMrNmBkJCtAbzVAIy5bZSxpcyk5Y2JodFklIjpOc1BhMUwxZlpNS3BjXFc/JyREOXNIalhlYzxbajxtT2ZmSycwOHVDbnAqaGdsQzt1I0MvMGo4dSxWNk40Q2A6SDQ3TEZtdXRMKE9GSyk7Uz49akwlYi5iRyRPTzI4KGAmPT1QPjdOVGpCcnBfOCthLSE7RVpkUltGMEYyTlduMy1iZDFfTSo3Mmd1cGlbSF1uSUQ0STIjcF87KVVQWXM7YlhDaGFUOSQxbyVXKktfXmZANjs7UyYwLlUoITQzIVVbdFpvQzpsYi1eQDVHOSVtRiVNPlJKQltzTF8jIUNuZGxTKix0VUtyVTY0LFUlTVVYbnRnKU42TztnQ1tDQilhP00oNUBuQzI1VUxRJGUiPE5iNjEzVXFfPW9qR091PyYsZlZEbllsI2clPkEmTCUhbWVKIixTVDEzJ08nQXNZRkljUXE+SS4pX2NFLCdvUjV1XDJOLW1lUmU0biszZVVyMXQ0TGhOTV1gUSdHW0ROR3JVaWJuYnMuYVc2JjtfQ0pvRzs+LUxPUGIpRTBvZnEvam0tNWowMmhPcFIzWV0wWyFFUDpnJVhBW0RdVUhWLFMhb1J1SjhaZUVKXTw0SVJcMihbaXRQR2VHK2JCdThXXGcxL2ArO0hgYTdVcEJFYjg3Y1duVXUoUW1TWCIwQkZPa2JLaSglWWUtPGphKEtoWmVVKCxFdWJETiFcL0hJXiVaZDdxQFtaTzpyWGRoQjReYTUtOHVvVW1JaUwkRFRgOypJNywnZD1eaTgpSF8pKm89X1huM2VPRmxoR1VlMDQyLUlTWWtIbERVK2phbiNxc1xNJz5rcyRrKiJZK2AlamksTF1lJWomRURkXDY5OUpQNS9Lbk9fKzJGRkEvJllJY1tXQ1wzSGIwcnFaUTxPS0xkS2dgRkYncDR0Sj5qMSUzU1xZRyo2ZGs6PkxOa1MqWEhzL1duKUIkcExEOiVFU1xWXGJiQyFuIzs8NFwmbl1uXz06RUUnQVhtK2EtJihDKWlOPDVoXm86K1RIJDdmNSQhajNkL01IOz8qKGEmImNNRyhPKCxkR2lXNWVuXVdSPldhQWgvUlZGJk0sOkI6YWxxYGteWkhbLVBjanInTFZeW08vWzhYMzxMRlkrVTc2SFckUENBUmxwImR1YnNoWlpXUlhNTHFYOWBcS3NdMyInZzlaZCU4KSFlTicwKU5Pc1ZkND1aUmdGbV9BQXRxTVJqK2NkUkByYmtJZDlkZnE0Ok1vY0pzLTFkaFtqQWhRNT05bFs7SWkqO0QwXDZOQEZZZC1YRjlCaWxxJUx0Xi48NWBlVUhDJEE/XHAxIjReamBVJF40Q2NeJn4+ZW5kc3RyZWFtCmVuZG9iagp4cmVmCjAgOQowMDAwMDAwMDAwIDY1NTM1IGYgCjAwMDAwMDAwNzMgMDAwMDAgbiAKMDAwMDAwMDExNCAwMDAwMCBuIAowMDAwMDAwMjIxIDAwMDAwIG4gCjAwMDAwMDAzMzMgMDAwMDAgbiAKMDAwMDAwMDUyNiAwMDAwMCBuIAowMDAwMDAwNTk0IDAwMDAwIG4gCjAwMDAwMDA4OTAgMDAwMDAgbiAKMDAwMDAwMDk0OSAwMDAwMCBuIAp0cmFpbGVyCjw8Ci9JRCAKWzwyM2FjYmQ1NzQwZTQ2MzEwZWU3ZDM5YWMyMWE2ZjEwMz48MjNhY2JkNTc0MGU0NjMxMGVlN2QzOWFjMjFhNmYxMDM+XQolIFJlcG9ydExhYiBnZW5lcmF0ZWQgUERGIGRvY3VtZW50IC0tIGRpZ2VzdCAoaHR0cDovL3d3dy5yZXBvcnRsYWIuY29tKQoKL0luZm8gNiAwIFIKL1Jvb3QgNSAwIFIKL1NpemUgOQo+PgpzdGFydHhyZWYKMjQyOQolJUVPRgo=";

  // Decode the Base64-encoded data to binary format
  const pdfData = Buffer.from(response, "base64");

  // Generate a unique filename for the PDF file
  const filename = `generated_pdf_${Date.now()}.pdf`;

  // Save the PDF data to a file on your server
  fs.writeFile(path.join(__dirname, filename), pdfData, (err) => {
    if (err) {
      console.error("Error saving PDF file:", err);
      res.status(500).send("Error generating PDF");
    } else {
      // Create a download link for the PDF file
      const downloadLink = `https://270f-106-201-234-104.ngrok-free.app/download/${filename}`;

      // Send the download link as a response to the client
      console.log(
        `Download your PDF from <a href="${downloadLink}">${downloadLink}</a>`
      );
    }
  });
};

app.get("");

generateToPDF();

app.listen(3000, () => {
  console.log("Server is listening on port 3000");
});
